% Mapping Generic Facts to Logical Model
% The LLM output is flat JSON keys "1", "2", "3", "4".
% Mangle flattener produces: json_str("root", Seat, Name).
% We map this to sit(Name, Seat).

sit(Name, Seat) :- json_str(_, Seat, Name).

% Topology: Round Table "1"-"4" (Using strings matching JSON keys)
is_right("1", "2").
is_right("2", "3").
is_right("3", "4").
is_right("4", "1").

is_opposite("1", "3").
is_opposite("3", "1").
is_opposite("2", "4").
is_opposite("4", "2").

is_next(X, Y) :- is_right(X, Y).
is_next(X, Y) :- is_right(Y, X).

% Entities: an, binh, cuong, dung
% (Names from LLM should be normalized or consistent with prompt)

% Constraint 1: An does not want to sit next to Binh
retry("Error: An cannot sit next to Binh") :-
    sit("An", P1),
    sit("Binh", P2),
    is_next(P1, P2).

% Constraint 2: Cuong must sit to the immediate right of An
% Violation if both are seated, but not is_right.
retry("Error: Cuong must sit to the immediate right of An") :-
    sit("An", P1),
    sit("Cuong", P2),
    !is_right(P1, P2).

% Constraint 3: Dung is sitting next to Binh
retry("Error: Dung must sit next to Binh") :-
    sit("Dung", P1),
    sit("Binh", P2),
    !is_next(P1, P2).
